(function () {
  "use strict";

  // Always allow updating UI without collisions
  window.__WEB_TOOLBOX_LOADED__ = true;

  var WebToolbox = window.WebToolbox || {};
  window.WebToolbox = WebToolbox;

  var UI_ID = "__web_toolbox_ui__v3";
  var LOG_ID = "__web_toolbox_log__v3";
  var STYLE_ID = "__web_toolbox_style__v3";

  function el(tag) {
    return document.createElement(tag);
  }

  function setStyles(node, pairs) {
    for (var i = 0; i < pairs.length; i++) {
      node.style[pairs[i][0]] = pairs[i][1];
    }
  }

  function safeText(v) {
    return typeof v === "string" ? v : JSON.stringify(v, null, 2);
  }

  function nowIso() {
    return new Date().toISOString();
  }

  function downloadText(filename, content) {
    var blob = new Blob([content], { type: "text/plain;charset=utf-8" });
    var url = URL.createObjectURL(blob);
    var a = el("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(function () {
      URL.revokeObjectURL(url);
    }, 5000);
  }

  async function copyText(str) {
    try {
      await navigator.clipboard.writeText(str);
      return true;
    } catch (_) {
      try {
        var ta = el("textarea");
        ta.value = str;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.style.top = "0";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        var ok = document.execCommand("copy");
        ta.remove();
        return ok;
      } catch (_) {
        return false;
      }
    }
  }

  function log(msg) {
    var box = document.getElementById(LOG_ID);
    if (!box) return;
    box.value += "[" + nowIso() + "] " + msg + "\n";
    box.scrollTop = box.scrollHeight;
  }

  // ---------------------------
  // Tools (existing)
  // ---------------------------
  function getVisibleText() {
    return (document.body && document.body.innerText) || document.documentElement.innerText || "";
  }

  function getDomHtml() {
    return "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
  }

  function prettyHtml(html) {
    html = String(html || "");
    html = html.replace(/\r\n/g, "\n").replace(/\r/g, "\n");
    html = html.replace(/>\s+</g, "><");

    var out = [];
    var indent = 0;
    var tokens = html.split(/(<[^>]+>)/g).filter(function (x) {
      return x !== "";
    });

    for (var i = 0; i < tokens.length; i++) {
      var tok = tokens[i];
      if (tok.startsWith("<")) {
        var isComment = /^<!--/.test(tok);
        var isDoctype = /^<!DOCTYPE/i.test(tok);
        var isClosing = /^<\//.test(tok);
        var isSelfClosing =
          /\/>$/.test(tok) ||
          /^<(!|meta|link|br|hr|img|input|source|area|base|col|embed|param|track|wbr)\b/i.test(tok);

        if (isClosing) indent = Math.max(0, indent - 1);
        out.push("  ".repeat(indent) + tok);
        if (!isClosing && !isSelfClosing && !isComment && !isDoctype) indent++;
      } else {
        var txt = tok.replace(/\s+/g, " ").trim();
        if (txt) out.push("  ".repeat(indent) + txt);
      }
    }
    return out.join("\n");
  }

  async function fetchServerHtml() {
    var res = await fetch(location.href, {
      method: "GET",
      credentials: "include",
      cache: "no-store",
    });
    var txt = await res.text();
    return {
      ok: res.ok,
      status: res.status,
      contentType: (res.headers.get("content-type") || "").toLowerCase(),
      body: txt,
    };
  }

  function extractMetadata() {
    var out = {};
    out.url = location.href;
    out.title = document.title || "";
    out.meta = [];

    var metas = Array.from(document.querySelectorAll("meta"));
    for (var i = 0; i < metas.length; i++) {
      var m = metas[i];
      var name = m.getAttribute("name");
      var prop = m.getAttribute("property");
      var content = m.getAttribute("content");
      if (!content) continue;
      out.meta.push({ name: name || null, property: prop || null, content: content });
    }

    var canonical = document.querySelector('link[rel="canonical"]');
    out.canonical = canonical ? canonical.getAttribute("href") : null;

    var jsonLd = Array.from(document.querySelectorAll('script[type="application/ld+json"]')).map(function (s) {
      return s.textContent || "";
    });
    out.jsonLd = jsonLd;

    return out;
  }

  function extractStructure() {
    var links = Array.from(document.querySelectorAll("a[href]")).map(function (a) {
      return { text: (a.innerText || "").trim(), href: a.href };
    });

    var headings = Array.from(document.querySelectorAll("h1,h2,h3,h4,h5,h6")).map(function (h) {
      return { tag: h.tagName, text: (h.innerText || "").trim() };
    });

    var images = Array.from(document.querySelectorAll("img")).map(function (img) {
      return {
        src: img.currentSrc || img.src || null,
        alt: img.alt || "",
        naturalWidth: img.naturalWidth || 0,
        naturalHeight: img.naturalHeight || 0,
      };
    });

    var forms = Array.from(document.querySelectorAll("form")).map(function (f) {
      var inputs = Array.from(f.querySelectorAll("input,textarea,select")).map(function (i) {
        return {
          tag: i.tagName,
          type: i.getAttribute("type") || null,
          name: i.getAttribute("name") || null,
          id: i.id || null,
        };
      });
      return {
        action: f.getAttribute("action") || null,
        method: (f.getAttribute("method") || "GET").toUpperCase(),
        inputs: inputs,
      };
    });

    return { links: links, headings: headings, images: images, forms: forms };
  }

  function listAssets() {
    var scripts = Array.from(document.querySelectorAll("script[src]")).map(function (s) {
      return s.src;
    });

    var css = Array.from(document.querySelectorAll('link[rel="stylesheet"][href]')).map(function (l) {
      return l.href;
    });

    var preload = Array.from(document.querySelectorAll('link[rel="preload"][href]')).map(function (l) {
      return { href: l.href, as: l.getAttribute("as") || null };
    });

    var media = Array.from(document.querySelectorAll("audio,video,source"))
      .map(function (m) {
        return m.src || m.getAttribute("src") || null;
      })
      .filter(Boolean);

    return { scripts: scripts, stylesheets: css, preload: preload, media: media };
  }

  function extractBackgroundImages(limit) {
    limit = typeof limit === "number" ? limit : 5000;
    var urls = new Set();

    var nodes = Array.from(document.querySelectorAll("*"));
    for (var i = 0; i < nodes.length && i < limit; i++) {
      var cs = getComputedStyle(nodes[i]);
      var bg = cs.backgroundImage || "";
      if (!bg || bg === "none") continue;

      var re = /url\(["']?([^"')]+)["']?\)/g;
      var match;
      while ((match = re.exec(bg))) {
        urls.add(match[1]);
      }
    }
    return Array.from(urls);
  }

  function extractVideos() {
    return Array.from(document.querySelectorAll("video")).map(function (v) {
      var sources = Array.from(v.querySelectorAll("source"))
        .map(function (s) {
          return s.src || s.getAttribute("src") || null;
        })
        .filter(Boolean);
      return { src: v.src || v.getAttribute("src") || null, sources: sources };
    });
  }

  function detectThirdPartyDomains() {
    function origin(u) {
      try {
        return new URL(u, location.href).origin;
      } catch (_) {
        return null;
      }
    }

    var own = location.origin;
    var domains = new Set();

    var candidates = [];
    Array.from(
      document.querySelectorAll("script[src],link[href],img[src],iframe[src],source[src],video[src],audio[src]")
    ).forEach(function (n) {
      candidates.push(n.src || n.href || n.getAttribute("src") || n.getAttribute("href"));
    });

    for (var i = 0; i < candidates.length; i++) {
      var u = candidates[i];
      if (!u) continue;
      var o = origin(u);
      if (!o) continue;
      if (o !== own) domains.add(o);
    }

    return Array.from(domains).sort();
  }

  function wordFrequency(topN) {
    topN = typeof topN === "number" ? topN : 30;
    var txt = getVisibleText().toLowerCase();
    txt = txt.replace(/[^\p{L}\p{N}\s]+/gu, " ");
    var parts = txt.split(/\s+/g).filter(Boolean);
    var map = Object.create(null);

    for (var i = 0; i < parts.length; i++) {
      var w = parts[i];
      if (w.length < 3) continue;
      map[w] = (map[w] || 0) + 1;
    }

    var arr = Object.keys(map).map(function (k) {
      return { word: k, count: map[k] };
    });

    arr.sort(function (a, b) {
      return b.count - a.count;
    });
    return arr.slice(0, topN);
  }

  function seoCheck() {
    var h1 = document.querySelectorAll("h1").length;
    var title = document.title || "";
    var desc = document.querySelector('meta[name="description"]');
    var canonical = document.querySelector('link[rel="canonical"]');

    var imgs = Array.from(document.querySelectorAll("img"));
    var missingAlt = imgs.filter(function (i) {
      return !i.alt || !i.alt.trim();
    }).length;

    return {
      titleLength: title.length,
      h1Count: h1,
      hasMetaDescription: !!desc,
      metaDescriptionLength: desc ? (desc.getAttribute("content") || "").length : 0,
      hasCanonical: !!canonical,
      images: imgs.length,
      imagesMissingAlt: missingAlt,
    };
  }

  function a11yCheck() {
    var buttons = Array.from(document.querySelectorAll("button"));
    var emptyButtons = buttons.filter(function (b) {
      var t = (b.innerText || "").trim();
      var aria = (b.getAttribute("aria-label") || "").trim();
      return !t && !aria;
    }).length;

    var inputs = Array.from(document.querySelectorAll("input,textarea,select"));
    var unlabeled = inputs.filter(function (i) {
      var id = i.id;
      var aria = (i.getAttribute("aria-label") || "").trim();
      if (aria) return false;
      if (id && document.querySelector('label[for="' + CSS.escape(id) + '"]')) return false;

      var parent = i.parentElement;
      while (parent) {
        if (parent.tagName === "LABEL") return false;
        parent = parent.parentElement;
      }
      return true;
    }).length;

    return {
      emptyButtons: emptyButtons,
      unlabeledInputs: unlabeled,
      inputs: inputs.length,
      buttons: buttons.length,
    };
  }

  function toggleReadingMode() {
    var id = "__web_toolbox_reading_css__";
    var existing = document.getElementById(id);
    if (existing) {
      existing.remove();
      return false;
    }
    var style = el("style");
    style.id = id;
    style.textContent =
      "header,nav,footer,aside,[role=banner],[role=navigation],[role=contentinfo],.ads,.ad,.cookie,.consent,.popup{display:none !important;}" +
      "body{max-width:900px !important;margin:0 auto !important;padding:24px !important;line-height:1.6 !important;}";
    document.documentElement.appendChild(style);
    return true;
  }

  function toggleDarkMode() {
    var id = "__web_toolbox_dark_css__";
    var existing = document.getElementById(id);
    if (existing) {
      existing.remove();
      return false;
    }
    var style = el("style");
    style.id = id;
    style.textContent =
      "html{filter:invert(1) hue-rotate(180deg) !important;background:#000 !important;}" +
      "img,video,iframe{filter:invert(1) hue-rotate(180deg) !important;}";
    document.documentElement.appendChild(style);
    return true;
  }

  function autoExpand() {
    var labels = ["show more", "read more", "more", "expand", "see more"];
    var clicked = 0;

    var buttons = Array.from(document.querySelectorAll("button,a,[role=button]"));
    for (var i = 0; i < buttons.length; i++) {
      var t = (buttons[i].innerText || "").toLowerCase().trim();
      if (!t) continue;
      for (var j = 0; j < labels.length; j++) {
        if (t === labels[j] || t.includes(labels[j])) {
          try {
            buttons[i].click();
            clicked++;
          } catch (_) {}
          break;
        }
      }
    }
    return clicked;
  }

  async function autoScroll(seconds) {
    seconds = typeof seconds === "number" ? seconds : 10;
    var end = Date.now() + seconds * 1000;
    var steps = 0;

    while (Date.now() < end) {
      window.scrollBy(0, Math.max(300, Math.floor(window.innerHeight * 0.8)));
      steps++;
      await new Promise(function (r) {
        setTimeout(r, 300);
      });
    }
    return steps;
  }

  function enableSniffer() {
    if (window.__WEB_TOOLBOX_SNIFF__) return false;
    window.__WEB_TOOLBOX_SNIFF__ = true;

    var origFetch = window.fetch;
    window.fetch = async function () {
      var url = arguments[0];
      try {
        log("fetch -> " + String(url));
      } catch (_) {}
      return origFetch.apply(this, arguments);
    };

    var origOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function (method, url) {
      try {
        log("xhr -> " + method + " " + String(url));
      } catch (_) {}
      return origOpen.apply(this, arguments);
    };

    return true;
  }

  // ---------------------------
  // NEW: IP extractor (page text only)
  // Note: This can only find IPs that are literally present in the page text/HTML.
  // It cannot reveal visitors’ IPs, nor hidden server-side data.
  // ---------------------------
  function extractIpAddresses() {
    var text = getVisibleText();

    var ipv4 = /\b(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\b/g;
    var ipv6 = /\b(?:[0-9a-fA-F]{1,4}:){2,7}[0-9a-fA-F]{1,4}\b/g;

    var matches = new Set();
    var m;

    while ((m = ipv4.exec(text))) matches.add(m[0]);
    while ((m = ipv6.exec(text))) matches.add(m[0]);

    return Array.from(matches).sort();
  }

  // ---------------------------
  // NEW: open jsDelivr purge in a new tab
  // (If your org blocks it, it will fail regardless of bookmark.)
  // ---------------------------
  function openJsDelivrPurge() {
    var purgeUrl = "https://purge.jsdelivr.net/gh/InteractionSystem/web-toolbox@main/web_toolbox.min.js";
    try {
      window.open(purgeUrl, "_blank", "noopener,noreferrer");
      return true;
    } catch (_) {
      return false;
    }
  }

  // ---------------------------
  // UI polish (still simple)
  // ---------------------------
  function ensureStyle() {
    if (document.getElementById(STYLE_ID)) return;

    var style = el("style");
    style.id = STYLE_ID;
    style.textContent =
      "#" + UI_ID + " *{box-sizing:border-box;}" +
      "#" + UI_ID + " button{font-family:inherit;}" +
      "#" + UI_ID + " .wtb-btn{transition:background 120ms ease, border-color 120ms ease, transform 60ms ease;}" +
      "#" + UI_ID + " .wtb-btn:hover{background:rgba(255,255,255,0.14)!important;border-color:rgba(255,255,255,0.16)!important;}" +
      "#" + UI_ID + " .wtb-btn:active{transform:translateY(1px);}" +
      "#" + UI_ID + " .wtb-chip{border:1px solid rgba(255,255,255,0.10);background:rgba(255,255,255,0.06);}" +
      "#" + UI_ID + " .wtb-sep{border-top:1px solid rgba(255,255,255,0.08);margin:10px 0;}" +
      "#" + UI_ID + " .wtb-label{font-size:12px;opacity:.9;}" +
      "#" + UI_ID + " .wtb-small{font-size:11px;opacity:.8;}" +
      "#" + UI_ID + " textarea{outline:none;}";
    document.documentElement.appendChild(style);
  }

  function openUi() {
    // Kill older versions if present
    try {
      var old1 = document.getElementById("__web_toolbox_ui__v1");
      if (old1) old1.remove();
      var old2 = document.getElementById("__web_toolbox_ui__v2");
      if (old2) old2.remove();
      var oldLog1 = document.getElementById("__web_toolbox_log__v1");
      if (oldLog1) oldLog1.remove();
      var oldLog2 = document.getElementById("__web_toolbox_log__v2");
      if (oldLog2) oldLog2.remove();
    } catch (_) {}

    if (document.getElementById(UI_ID)) return;

    ensureStyle();

    var wrap = el("div");
    wrap.id = UI_ID;

    setStyles(wrap, [
      ["position", "fixed"],
      ["right", "16px"],
      ["bottom", "16px"],
      ["zIndex", "2147483647"],
      ["width", "460px"],
      ["fontFamily", "system-ui, -apple-system, Segoe UI, Roboto, sans-serif"],
      ["background", "rgba(18,18,18,0.94)"],
      ["color", "#f3f3f3"],
      ["border", "1px solid rgba(255,255,255,0.10)"],
      ["borderRadius", "14px"],
      ["boxShadow", "0 18px 44px rgba(0,0,0,0.45)"],
      ["padding", "12px"],
      ["backdropFilter", "blur(6px)"],
    ]);

    var top = el("div");
    setStyles(top, [
      ["display", "flex"],
      ["alignItems", "center"],
      ["justifyContent", "space-between"],
      ["gap", "10px"],
    ]);

    var left = el("div");
    setStyles(left, [["display", "flex"], ["flexDirection", "column"], ["gap", "4px"]]);

    var title = el("div");
    title.textContent = "Web Toolbox";
    setStyles(title, [["fontWeight", "800"], ["fontSize", "15px"], ["letterSpacing", "0.2px"]]);

    var sub = el("div");
    sub.textContent = "Page inspector • copy / export";
    setStyles(sub, [["fontSize", "11px"], ["opacity", "0.75"]]);

    left.appendChild(title);
    left.appendChild(sub);

    var close = el("button");
    close.type = "button";
    close.textContent = "×";
    setStyles(close, [
      ["cursor", "pointer"],
      ["width", "32px"],
      ["height", "32px"],
      ["borderRadius", "10px"],
      ["border", "1px solid rgba(255,255,255,0.12)"],
      ["background", "rgba(255,255,255,0.06)"],
      ["color", "#fff"],
      ["fontSize", "18px"],
      ["fontWeight", "900"],
      ["lineHeight", "0"],
    ]);
    close.className = "wtb-btn";
    close.addEventListener("click", function () {
      wrap.remove();
    });

    top.appendChild(left);
    top.appendChild(close);

    var sep = el("div");
    sep.className = "wtb-sep";

    var grid = el("div");
    setStyles(grid, [
      ["display", "grid"],
      ["gridTemplateColumns", "1fr 1fr"],
      ["gap", "8px"],
    ]);

    function mkBtn(label, onClick) {
      var b = el("button");
      b.type = "button";
      b.textContent = label;
      b.className = "wtb-btn";
      setStyles(b, [
        ["cursor", "pointer"],
        ["padding", "10px 10px"],
        ["borderRadius", "12px"],
        ["border", "1px solid rgba(255,255,255,0.10)"],
        ["background", "rgba(255,255,255,0.08)"],
        ["color", "#f3f3f3"],
        ["fontSize", "12px"],
        ["fontWeight", "700"],
        ["textAlign", "left"],
      ]);
      b.addEventListener("click", onClick);
      return b;
    }

    var output = el("textarea");
    output.id = LOG_ID;
    output.readOnly = false;
    setStyles(output, [
      ["width", "100%"],
      ["height", "220px"],
      ["marginTop", "10px"],
      ["padding", "10px"],
      ["borderRadius", "12px"],
      ["border", "1px solid rgba(255,255,255,0.10)"],
      ["background", "rgba(0,0,0,0.30)"],
      ["color", "#e8e8e8"],
      ["fontSize", "12px"],
      ["resize", "vertical"],
      ["whiteSpace", "pre"],
    ]);
    output.value = "Ready.\n";

    var actions = el("div");
    setStyles(actions, [["display", "flex"], ["gap", "8px"], ["marginTop", "10px"]]);

    var btnCopyOut = mkBtn("Copy output", async function () {
      var ok = await copyText(output.value);
      log(ok ? "Copied output." : "Copy blocked.");
    });

    var btnDownloadOut = mkBtn("Download output", function () {
      downloadText("web_toolbox_output_" + Date.now() + ".txt", output.value);
      log("Downloaded output.");
    });

    setStyles(btnCopyOut, [["flex", "1"]]);
    setStyles(btnDownloadOut, [["flex", "1"]]);

    actions.appendChild(btnCopyOut);
    actions.appendChild(btnDownloadOut);

    // ---- tool buttons (full set + IP + purge)
    grid.appendChild(
      mkBtn("Extract IP Addresses", function () {
        var ips = extractIpAddresses();
        output.value = ips.length ? ips.join("\n") : "No IP addresses found in visible text.";
        log("IP scan complete. Found: " + ips.length);
      })
    );

    grid.appendChild(
      mkBtn("Open jsDelivr Purge", function () {
        var ok = openJsDelivrPurge();
        log(ok ? "Opened purge page." : "Popup blocked.");
      })
    );

    grid.appendChild(
      mkBtn("Copy Visible Text", async function () {
        var t = getVisibleText();
        output.value = t;
        var ok = await copyText(t);
        log(ok ? "Copied visible text (" + t.length + " chars)." : "Copy blocked.");
      })
    );

    grid.appendChild(
      mkBtn("Copy DOM HTML", async function () {
        var h = getDomHtml();
        output.value = h;
        var ok = await copyText(h);
        log(ok ? "Copied DOM HTML (" + h.length + " chars)." : "Copy blocked.");
      })
    );

    grid.appendChild(
      mkBtn("Copy DOM HTML (Pretty)", async function () {
        var h = prettyHtml(getDomHtml());
        output.value = h;
        var ok = await copyText(h);
        log(ok ? "Copied pretty DOM HTML (" + h.length + " chars)." : "Copy blocked.");
      })
    );

    grid.appendChild(
      mkBtn("Copy Server HTML", async function () {
        log("Fetching server HTML...");
        var r = await fetchServerHtml();
        output.value = r.body;
        var ok = await copyText(r.body);
        log(ok ? "Copied server HTML (" + r.body.length + " chars). status=" + r.status : "Copy blocked.");
      })
    );

    grid.appendChild(
      mkBtn("Metadata (JSON)", function () {
        var m = extractMetadata();
        output.value = safeText(m);
        log("Extracted metadata.");
      })
    );

    grid.appendChild(
      mkBtn("Structure (links/images/forms)", function () {
        var s = extractStructure();
        output.value = safeText(s);
        log("Extracted structure.");
      })
    );

    grid.appendChild(
      mkBtn("Assets (css/js/media)", function () {
        var a = listAssets();
        output.value = safeText(a);
        log("Listed assets.");
      })
    );

    grid.appendChild(
      mkBtn("Background Images", function () {
        var b = extractBackgroundImages();
        output.value = safeText({ count: b.length, urls: b });
        log("Extracted background images: " + b.length);
      })
    );

    grid.appendChild(
      mkBtn("Videos (sources)", function () {
        var v = extractVideos();
        output.value = safeText(v);
        log("Extracted videos.");
      })
    );

    grid.appendChild(
      mkBtn("Trackers (3rd-party domains)", function () {
        var d = detectThirdPartyDomains();
        output.value = safeText({ count: d.length, domains: d });
        log("Detected third-party domains: " + d.length);
      })
    );

    grid.appendChild(
      mkBtn("Word Frequency (top 30)", function () {
        var w = wordFrequency(30);
        output.value = safeText(w);
        log("Computed word frequency.");
      })
    );

    grid.appendChild(
      mkBtn("SEO Check", function () {
        var s = seoCheck();
        output.value = safeText(s);
        log("Ran SEO checks.");
      })
    );

    grid.appendChild(
      mkBtn("A11y Check", function () {
        var a = a11yCheck();
        output.value = safeText(a);
        log("Ran accessibility checks.");
      })
    );

    grid.appendChild(
      mkBtn("Toggle Reading Mode", function () {
        var on = toggleReadingMode();
        log(on ? "Reading mode ON." : "Reading mode OFF.");
      })
    );

    grid.appendChild(
      mkBtn("Toggle Dark Mode", function () {
        var on = toggleDarkMode();
        log(on ? "Dark mode ON." : "Dark mode OFF.");
      })
    );

    grid.appendChild(
      mkBtn("Auto Expand (Show more)", function () {
        var n = autoExpand();
        log("Auto expand clicked: " + n);
      })
    );

    grid.appendChild(
      mkBtn("Auto Scroll (10s)", async function () {
        log("Auto scroll start (10s)...");
        var steps = await autoScroll(10);
        log("Auto scroll done. steps=" + steps);
      })
    );

    grid.appendChild(
      mkBtn("Enable API Sniffer", function () {
        var on = enableSniffer();
        log(on ? "Sniffer enabled (logs fetch/xhr)." : "Sniffer already enabled.");
      })
    );

    grid.appendChild(
      mkBtn("Close Toolbox", function () {
        wrap.remove();
      })
    );

    wrap.appendChild(top);
    wrap.appendChild(sep);
    wrap.appendChild(grid);
    wrap.appendChild(actions);
    wrap.appendChild(output);

    document.documentElement.appendChild(wrap);
  }

  WebToolbox.open = openUi;

  // Auto-open
  openUi();
})();
